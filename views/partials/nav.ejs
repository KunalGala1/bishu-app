<%
const nav = {
  menu: 'nav-menu', link_classes: 'nav-link', map: [
  {name: 'home'},
  {name: 'about'},
  {name: 'music'},
  {name: 'videos'},
  {name: 'blog'},
  {name: 'contact'} 
  ]
}

const generateMenu = data => {
  let html = `<ul class="${data.menu}">`;
  data.map.forEach(item => {
    const name = item.name;
    let href = (item.name === 'home') ? '/' : (item.href || `/${item.name}`);    
    if (!item.menu) html += `<li><a href='${href}' class="${data.link_classes}">${name}</a></li>`;
    else { html += `<li class="${item.menu + '--parent'}"><span>${name}</span>${generateMenu(item)}</li>`}
  })
  html += `</ul>`
  return html;
}
%>

<nav class="flex gap-md">

	<div class="socials flex gap-md">
		<a href="https://www.facebook.com/" class="socials-link"><i class="fab fa-facebook-f"></i></a>
		<a href="https://www.instagram.com/" class="socials-link"><i class="fab fa-instagram"></i></a>
		<a href="https://www.youtube.com/" class="socials-link"><i class="fab fa-youtube"></i></a>
		<a href="https://www.spotify.com/" class="socials-link"><i class="fab fa-spotify"></i></a>
	</div>

	<div class="logo" data-hover="rotate">
		<a href="/">
			<img src="/img/logo.jpg" alt="logo" />
		</a>
	</div>

	<%- generateMenu(nav) %>

	<div class="burger">
		<div></div>
		<div></div>
	</div>
</nav>

<script>
	const currentPath = window.location.pathname.replace( /\/$/, '' );
	document.querySelectorAll( '.nav-link' )
		.forEach( link => {
			link.classList.toggle( 'active', link.getAttribute( 'href' ) === currentPath || ( link.getAttribute( 'href' ) === '/' && currentPath === '' ) );
			link.setAttribute( 'data-hover', 'underline' ); // optional
		} );
</script>

<style>
	.scroll-top-btn {
		display: none;
		position: fixed;
		bottom: 20px;
		right: 20px;
		background-color: #333;
		color: #fff;
		border: none;
		border-radius: 50%;
		padding: 10px 15px;
		cursor: pointer;
		z-index: 1000;
		transition: opacity 0.3s;
	}

	.scroll-top-btn:hover {
		background-color: #555;
	}

	nav.nav-active .nav-menu {
        display: flex; /* Or your preferred style for active state */
		height: 100vh;
		position: fixed;
		top: 0;
		right: 0;
		background-color: var(--main);
		width: 100vw;
		justify-content: center;
		align-items: center;
		flex-direction: column;
		gap: 16px;
    }

	.burger-active div:first-child {
		transform: rotate(45deg) translate(6px, 6px);
	}
	.burger-active div:last-child {
		transform: rotate(-45deg);
	}
	.no-scroll {
		overflow: hidden;
	}
</style>

<div id="scrollTopBtn" class="scroll-top-btn">
	<i class="fas fa-angle-up"></i>
</div>

<script>
	document.addEventListener( 'DOMContentLoaded', function ( ) {
		// Handle burger menu toggle
        const burger = document.querySelector('.burger');
        const navMenu = document.querySelector('nav');

        burger.addEventListener('click', function() {
            navMenu.classList.toggle('nav-active');
			burger.classList.toggle('burger-active');
			document.body.classList.toggle('no-scroll');
        });

		// Scroll to top button
		const scrollTopBtn = document.getElementById( 'scrollTopBtn' );
		let hideTimeout; // Declare this variable to hold the timeout reference

		function checkScrollPosition ( ) {
			if ( window.scrollY > 500 ) {
				clearTimeout( hideTimeout ); // Cancel the timeout
				scrollTopBtn.style.display = 'block'; // Ensure it's set to block immediately
				scrollTopBtn.style.opacity = '1';
			} else {
				scrollTopBtn.style.opacity = '0';
				hideTimeout = setTimeout( function ( ) {
					// Only hide if the opacity remains '0'
					if ( scrollTopBtn.style.opacity === '0' ) {
						scrollTopBtn.style.display = 'none';
					}
				}, 300 ); // Hide after fade out
			}
		}

		// Initial check outside of the scroll listener
		checkScrollPosition( );

		window.addEventListener( 'scroll', checkScrollPosition );

		scrollTopBtn.addEventListener( 'click', function ( ) {
			window.scrollTo( {
				top: 0,
				left: 0,
				behavior: 'smooth' // Smooth scrolling effect
			} );
		} );
	} );
</script>